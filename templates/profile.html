<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¡«å¯«åœ–æ¨™é¡¯ç¤ºè³‡æ–™</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='img/omtw.ico') }}" type="image/x-icon">
  <!-- Leaflet åœ°åœ– CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <!-- Esri åœ°ç†æœå°‹ CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/esri-leaflet-geocoder/dist/esri-leaflet-geocoder.css"
  />
</head>
<body>
  <h1>å¡«å¯«åœ–æ¨™é¡¯ç¤ºè³‡æ–™</h1>
  <form method="POST" action="{{ form_action }}">

    <!-- âœ… æ˜¯å¦å…¬é–‹çœŸå¯¦å§“å -->
    <label>
      <input type="checkbox" name="real_name_public" {% if profile and profile.real_name_public %}checked{% endif %}>
      é¡¯ç¤ºçœŸå¯¦å§“åï¼ˆå‹¾é¸å¾Œåœ–æ¨™ä¸Šæœƒé¡¯ç¤ºçœŸåï¼‰
    </label><br><br>

    <label>æœå‹™å€åŸŸï¼š
      <input type="text" name="service_area" required value="{{ profile.service_area if profile else '' }}">
    </label><br><br>

    <label>å¸«åŸ¹çµè¨“å¹´åº¦ï¼ˆå¿…å¡«ï¼‰ï¼š
      <input type="number" name="certification_year" required value="{{ profile.certification_year if profile else '' }}">
    </label><br><br>

    <label>çµè¨“è­‰è™Ÿï¼ˆå¿…å¡«ï¼‰ï¼š
      <input type="text" name="certification_number" required value="{{ profile.certification_number if profile else '' }}">
    </label><br><br>

    <label>åœ‹å®¶æª¢å®šè­‰è™Ÿï¼ˆå¯é¸å¡«ï¼‰ï¼š
      <input type="text" name="license_number" placeholder="å¦‚ç„¡å¯ç•™ç©º" value="{{ profile.license_number if profile else '' }}">
    </label><br><br>

    <!-- ğŸ“ åœ°é»åç¨±ï¼ˆé€™æ¬„ä¸å­˜å…¥ DBï¼Œæ‰€ä»¥ç„¡æ³•é å¡«ï¼‰-->
    <label>è¼¸å…¥åœ°é»åç¨±ï¼ˆè¼¸å…¥å¾Œå†æŒ‰ä¸‹ã€ŒæŸ¥è©¢åº§æ¨™ã€å³å¯è‡ªå‹•å¡«å…¥ç¶“ç·¯åº¦ï¼‰ï¼š
      <input type="text" id="location-name" placeholder="è«‹è¼¸å…¥æ‚¨æ–¹ä¾¿æ¨™è¨˜çš„å…¬å…±ç©ºé–“ä½ç½®ï¼Œä¾‹å¦‚ï¼šæ·¡æ°´æ·é‹ç«™">
      <button type="button" onclick="searchLocation()">æŸ¥è©¢åº§æ¨™</button>
    </label><br><br>

    <!-- ğŸŒ ç¶“ç·¯åº¦ -->
    <label>ç·¯åº¦ (lat)ï¼š
      <input type="text" id="lat" name="lat" required readonly value="{{ profile.lat if profile else '' }}">
    </label><br>

    <label>ç¶“åº¦ (lng)ï¼š
      <input type="text" id="lng" name="lng" required readonly value="{{ profile.lng if profile else '' }}">
    </label><br><br>

    <!-- âœ… å…·å‚™è¦–éšœç”Ÿæ´»æŠ€èƒ½æ•™å­¸è³‡æ ¼ -->
    <label>
      <input type="checkbox" name="can_teach_online" {% if profile and profile.can_teach_online %}checked{% endif %}>
      å…·å‚™è¦–éšœç”Ÿæ´»æŠ€èƒ½æ•™å­¸è³‡æ ¼
    </label><br><br>

    <!-- ğŸ•’ å¯ä¸Šèª²æ™‚é–“ï¼ˆè¤‡é¸ï¼‰-->
    <fieldset>
      <legend><strong>ğŸ•’ å¯ä¸Šèª²æ™‚é–“ï¼ˆå¯è¤‡é¸ï¼‰</strong></legend>
      {% set times = profile.available_times.split(',') if profile and profile.available_times else [] %}
      <label><input type="checkbox" name="available_times" value="weekday_day" {% if 'weekday_day' in times %}checked{% endif %}> å¹³æ—¥ç™½å¤©</label><br>
      <label><input type="checkbox" name="available_times" value="weekday_night" {% if 'weekday_night' in times %}checked{% endif %}> å¹³æ—¥æ™šä¸Š</label><br>
      <label><input type="checkbox" name="available_times" value="weekend_day" {% if 'weekend_day' in times %}checked{% endif %}> é€±æœ«ç™½å¤©</label><br>
      <label><input type="checkbox" name="available_times" value="weekend_night" {% if 'weekend_night' in times %}checked{% endif %}> é€±æœ«æ™šä¸Š</label>
    </fieldset><br>

    <!-- ğŸš— äº¤é€šæ–¹å¼ï¼ˆè¤‡é¸ï¼‰-->
    <fieldset>
      <legend><strong>ğŸš— äº¤é€šæ–¹å¼ï¼ˆå¯è¤‡é¸ï¼‰</strong></legend>
      {% set transport = profile.transport_modes.split(',') if profile and profile.transport_modes else [] %}
      <label><input type="checkbox" name="transport" value="public" {% if 'public' in transport %}checked{% endif %}> å¤§çœ¾é‹è¼¸</label><br>
      <label><input type="checkbox" name="transport" value="scooter" {% if 'scooter' in transport %}checked{% endif %}> æ©Ÿè»Š</label><br>
      <label><input type="checkbox" name="transport" value="car" {% if 'car' in transport %}checked{% endif %}> é–‹è»Š</label>
    </fieldset><br>

    <!-- ğŸ“ è‡ªæˆ‘ä»‹ç´¹ -->
    <label>è‡ªæˆ‘ä»‹ç´¹ï¼š<br>
      <textarea name="intro" rows="5" cols="40" placeholder="ç°¡çŸ­ä»‹ç´¹ï¼ŒåŒ…å«æ–¹ä¾¿å…¬é–‹çš„è¯çµ¡æ–¹å¼ã€‚">{{ profile.intro if profile else '' | e }}</textarea>
    </label><br><br>

    <!-- ğŸ‘©â€ğŸ« æ•™å­¸ç¶“é©— -->
    <fieldset>
      <legend><strong>ğŸ‘©â€ğŸ« æ‚¨æ›¾ç¶“æœ‰éçš„æ•™å­¸ç¶“é©—ï¼ˆè«‹æ ¹æ“šäº‹å¯¦ï¼Œå¯è¤‡é¸ï¼‰</strong></legend>
      {% set teach_exp = profile.teaching_experience.split(',') if profile and profile.teaching_experience else [] %}
      <label><input type="checkbox" name="teaching_experience" value="visually_impaired" {% if 'visually_impaired' in teach_exp %}checked{% endif %}> å–®ç´”è¦–éšœ</label><br>
      <label><input type="checkbox" name="teaching_experience" value="multi_disabilities" {% if 'multi_disabilities' in teach_exp %}checked{% endif %}> è¦–è¦º+å…¶ä»–éšœç¤™ï¼ˆè¦–å¤šéšœï¼‰</label><br>
      <label><input type="checkbox" name="teaching_experience" value="preschool" {% if 'preschool' in teach_exp %}checked{% endif %}> å­¸é½¡å‰ï¼ˆå¹¼å…’ï¼‰</label><br>
      <label><input type="checkbox" name="teaching_experience" value="students" {% if 'students' in teach_exp %}checked{% endif %}> å­¸ç”Ÿï¼ˆä¸å«å¤§å­¸ï¼‰</label><br>
      <label><input type="checkbox" name="teaching_experience" value="adults" {% if 'adults' in teach_exp %}checked{% endif %}> æˆäººï¼ˆå«å¤§å­¸ç”Ÿï¼‰</label><br>
      <label><input type="checkbox" name="teaching_experience" value="seniors" {% if 'seniors' in teach_exp %}checked{% endif %}> é«˜é½¡è€…ï¼ˆ70æ­²ä»¥ä¸Šï¼‰</label>
    </fieldset><br>

    <!-- ğŸ—£ï¸ èªè¨€èƒ½åŠ› -->
    <fieldset>
      <legend><strong>ğŸ—£ï¸ èªè¨€èƒ½åŠ›ï¼ˆå¯è¤‡é¸ï¼‰</strong></legend>
      {% set langs = profile.lang_skills.split(',') if profile else [] %}
      <label><input type="checkbox" name="language_skills" value="mandarin" {% if 'mandarin' in langs %}checked{% endif %}> è¯èª</label><br>
      <label><input type="checkbox" name="language_skills" value="taiwanese" {% if 'taiwanese' in langs %}checked{% endif %}> å°èª</label><br>
      <label><input type="checkbox" name="language_skills" value="english" {% if 'english' in langs %}checked{% endif %}> è‹±èª</label><br>
      <label><input type="checkbox" name="language_skills" value="hakka" {% if 'hakka' in langs %}checked{% endif %}> å®¢èª</label><br>

      {% set other_lang = '' %}
      {% for lang in langs %}
        {% if lang.startswith('other:') %}
          {% set other_lang = lang.split(':', 1)[1] %}
        {% endif %}
      {% endfor %}

      <label>
        <input type="checkbox" id="lang-other-checkbox" name="language_skills" value="other" {% if other_lang %}checked{% endif %} onchange="toggleOtherLangInput()"> å…¶ä»–ï¼š
      </label>
       <input type="text" id="lang-other-text" name="language_other" style="display: {% if other_lang %}inline-block{% else %}none{% endif %};" placeholder="è«‹è¼¸å…¥å…¶ä»–èªè¨€" value="{{ other_lang }}"><br>
    </fieldset><br>

    <label>
      <input type="checkbox" name="agree_terms" required {% if profile and profile.agree_terms %}checked{% endif %}>
      æœ¬äººç¢ºèªæ‰€å¡«è³‡æ–™çš†å±¬å¯¦ï¼Œè‹¥æœ‰ä¸å¯¦æˆ–å½é€ ï¼Œå°‡è‡ªè¡Œè² æ³•å¾‹è²¬ä»»ï¼Œä¸¦èˆ‡æœ¬å¹³å°ç„¡é—œã€‚
    </label><br><br>

    <button type="submit">é€å‡ºç”³è«‹</button><br><br>
    <button type="button" onclick="window.history.back()">å–æ¶ˆç”³è«‹</button>

  </form>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <ul>
        {% for message in messages %}
          <li>{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  <!-- Leaflet åœ°åœ– JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    function toggleOtherLangInput() {
      const checkbox = document.getElementById('lang-other-checkbox');
      const input = document.getElementById('lang-other-text');
      input.style.display = checkbox.checked ? 'inline-block' : 'none';
    }

    async function searchLocation() {
      const locationName = document.getElementById('location-name').value;
      if (!locationName) {
        alert('è«‹è¼¸å…¥åœ°é»åç¨±');
        return;
      }

      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(locationName)}&limit=1`;

      try {
        const response = await fetch(url, {
          headers: {
            'Accept-Language': 'zh-TW',
            'User-Agent': 'your-app-name-here'
          }
        });
        const data = await response.json();

        if (data.length === 0) {
          alert('æŸ¥ç„¡çµæœï¼Œè«‹æ›å€‹åç¨±è©¦è©¦');
          return;
        }

        const lat = data[0].lat;
        const lon = data[0].lon;
        document.getElementById('lat').value = parseFloat(lat).toFixed(6);
        document.getElementById('lng').value = parseFloat(lon).toFixed(6);
        alert('æŸ¥è©¢æˆåŠŸï¼Œå·²å¡«å…¥åº§æ¨™');
      } catch (error) {
        alert('ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
        console.error(error);
      }
    }
  </script>
</body>
</html>
